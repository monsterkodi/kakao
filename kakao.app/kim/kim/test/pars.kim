# â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ    â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ   â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ    â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ
# â–ˆâ–ˆâ–ˆ   â–ˆâ–ˆâ–ˆ  â–ˆâ–ˆâ–ˆ   â–ˆâ–ˆâ–ˆ  â–ˆâ–ˆâ–ˆ   â–ˆâ–ˆâ–ˆ  â–ˆâ–ˆâ–ˆ     
# â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ   â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ    â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ 
# â–ˆâ–ˆâ–ˆ        â–ˆâ–ˆâ–ˆ   â–ˆâ–ˆâ–ˆ  â–ˆâ–ˆâ–ˆ   â–ˆâ–ˆâ–ˆ       â–ˆâ–ˆâ–ˆ
# â–ˆâ–ˆâ–ˆ        â–ˆâ–ˆâ–ˆ   â–ˆâ–ˆâ–ˆ  â–ˆâ–ˆâ–ˆ   â–ˆâ–ˆâ–ˆ  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ 

import ../kommon
import ../pars
    
template t(a:string, b:string) = testCmp(a, $ast(a), b, instantiationInfo())

â–¸ pars

    â–¸ math ops
        
        t "1 + 5 * 3"                               , "â–ª[(â—†number + (â—†number * â—†number))]"
        t "1 * 5 - 3"                               , "â–ª[((â—†number * â—†number) - â—†number)]"
        t "-5 - -3"                                 , "â–ª[((- â—†number) - (- â—†number))]"
        t "a++ + b--"                               , "â–ª[((â—†name ++) + (â—†name --))]"
        t "1 + 2 + 3"                               , "â–ª[((â—†number + â—†number) + â—†number)]"
        t "1 * 2 + 3 * 4"                           , "â–ª[((â—†number * â—†number) + (â—†number * â—†number))]"
        
    â–¸ boolean ops
    
        t "a && b || c"                             , "â–ª[((â—†name && â—†name) || â—†name)]"
        t "a and b or c"                            , "â–ª[((â—†name && â—†name) || â—†name)]"
        t "!a && b"                                 , "â–ª[((! â—†name) && â—†name)]"
        t "not a && b"                              , "â–ª[((! â—†name) && â—†name)]"
        t "a || b && c"                             , "â–ª[(â—†name || (â—†name && â—†name))]"
        t "a or b and c"                            , "â–ª[(â—†name || (â—†name && â—†name))]"
        t "a && b == c"                             , "â–ª[(â—†name && (â—†name == â—†name))]"
        t "a and b == c"                            , "â–ª[(â—†name && (â—†name == â—†name))]"
        t "x = a || b"                              , "â–ª[(â—†name = (â—†name || â—†name))]"
        t "x = a or b"                              , "â–ª[(â—†name = (â—†name || â—†name))]"
        t "!a || !b"                                , "â–ª[((! â—†name) || (! â—†name))]"
        t "not a or not b"                          , "â–ª[((! â—†name) || (! â—†name))]"
        
    â–¸ comparison ops
    
        t "a == b"                                  , "â–ª[(â—†name == â—†name)]"
        t "a != b"                                  , "â–ª[(â—†name != â—†name)]"
        t "a >= b"                                  , "â–ª[(â—†name >= â—†name)]"
        t "a <= b"                                  , "â–ª[(â—†name <= â—†name)]"

    â–¸ parens
    
        t "(1 + 2) * 3"                             , "â–ª[(â—†[(â—†number + â—†number)] * â—†number)]"
        t "(1)"                                     , "â–ª[â—†[â—†number]]"
        t "(a + b) * c"                             , "â–ª[(â—†[(â—†name + â—†name)] * â—†name)]"
        t "a * (b + c)"                             , "â–ª[(â—†name * â—†[(â—†name + â—†name)])]"
        t "((1))"                                   , "â–ª[â—†[â—†number]]"
        t "(a.b).c"                                 , "â–ª[(â—†[(â—†name . â—†name)] . â—†name)]"
        t "a.b.c"                                   , "â–ª[((â—†name . â—†name) . â—†name)]"
        
        t "a * (b + c) / d"                         , "â–ª[((â—†name * â—†[(â—†name + â—†name)]) / â—†name)]"
        t "3 * (1 + 2)"                             , "â–ª[(â—†number * â—†[(â—†number + â—†number)])]"
        
    â–¸ brackets
    
        t "options = {poStdErrToStdOut, poUsePath}" , "â–ª[(â—†name = {â—†name, â—†name})]"
        t "args = [\"r\", f]"                       , "â–ª[(â—†name = [[â—†string, â—†name]]])]"
        
    â–¸ types
    
        t "â—‡int i"                                  , "â–ª[(â—‡type(int) â—†name)]"
        t "â—†int i"                                  , "â–ª[(â—†type(int) â—†name)]"
        t "â—‡string s"                               , "â–ª[(â—‡type(string) â—†name)]"
        t "â—†string s"                               , "â–ª[(â—†type(string) â—†name)]"
        t "â—‡seq[string] s"                          , "â–ª[(â—‡type(seq[string]) â—†name)]"
        t "â—†seq[string] s"                          , "â–ª[(â—†type(seq[string]) â—†name)]"
        t "â—‡Parser p"                               , "â–ª[(â—‡type(Parser) â—†name)]"
        t "â—†Parser p"                               , "â–ª[(â—†type(Parser) â—†name)]"

        t "â—‡int i = 1"                              , "â–ª[(â—‡type(int) â—†name (= â—†number))]"
        t "â—‡int i = 1+1"                            , "â–ª[(â—‡type(int) â—†name (= (â—†number + â—†number)))]"
        
        t "â—†string s = \"a\""                       , "â–ª[(â—†type(string) â—†name (= â—†string))]"
        t "â—†string s = \"a\" & \"b\""               , "â–ª[(â—†type(string) â—†name (= (â—†string & â—†string)))]"
        
        t "â—‡seq[string] s = @[]"                    , "â–ª[(â—‡type(seq[string]) â—†name (= (â—†name[])))]"
        
    â–¸ func
    
        t "->"                                      , "â–ª[(->)]"
        t "f = ->"                                  , "â–ª[(â—†name = (->))]" 
        t "f = (a=1) ->"                            , "â–ª[(â—†name = (â—†[(â—‡ â—†name (= â—†number))] ->))]" 
        t "f = a=1 ->"                              , "â–ª[(â—†name = (â—†[(â—‡ â—†name (= â—†number))] ->))]" 
        t "f = (a) ->"                              , "â–ª[(â—†name = (â—†[(â—‡ â—†name)] ->))]" 
        t "f = a ->"                                , "â–ª[(â—†name = (â—†[(â—‡ â—†name)] ->))]" 
        t "f = a b ->"                              , "â–ª[(â—†name = (â—†[(â—‡ â—†name), (â—‡ â—†name)] ->))]" 
        
        t "â—‡int i ->"                               , "â–ª[(â—†[(â—‡type(int) â—†name)] ->)]"
        t "â—‡int a â—‡int b ->"                        , "â–ª[(â—†[(â—‡type(int) â—†name), (â—‡type(int) â—†name)] ->)]"
        t "â—‡int a â—‡int b â—‡int c ->"                 , "â–ª[(â—†[(â—‡type(int) â—†name), (â—‡type(int) â—†name), (â—‡type(int) â—†name)] ->)]"
        t "â—†Parser p â—‡string a â—‡int b ->"           , "â–ª[(â—†[(â—†type(Parser) â—†name), (â—‡type(string) â—†name), (â—‡type(int) â—†name)] ->)]"
        
        t "âœint ->"                                 , "â–ª[( âœ type(int) ->)]"
        t "âœ string ->"                             , "â–ª[( âœ type(string) ->)]"
        t "â—‡int i âœint ->"                          , "â–ª[(â—†[(â—‡type(int) â—†name)] âœ type(int) ->)]"
        t "â—‡int i âœstring ->"                       , "â–ª[(â—†[(â—‡type(int) â—†name)] âœ type(string) ->)]"
        
        t "â—‡int i=1 ->"                             , "â–ª[(â—†[(â—‡type(int) â—†name (= â—†number))] ->)]"
        t "â—‡int i=1 â—‡int j=2 ->"                    , "â–ª[(â—†[(â—‡type(int) â—†name (= â—†number)), (â—‡type(int) â—†name (= â—†number))] ->)]"
        t "â—‡int i=1 â—‡int j=2 âœstring ->"            , "â–ª[(â—†[(â—‡type(int) â—†name (= â—†number)), (â—‡type(int) â—†name (= â—†number))] âœ type(string) ->)]"

        t "â—‡string s=\"âœ”\" ->"                      , "â–ª[(â—†[(â—‡type(string) â—†name (= â—†string))] ->)]"
        
        t "f = â—‡string a ->"                        , "â–ª[(â—†name = (â—†[(â—‡type(string) â—†name)] ->))]"
        t "f = â—‡string a â—‡int b ->"                 , "â–ª[(â—†name = (â—†[(â—‡type(string) â—†name), (â—‡type(int) â—†name)] ->))]"
        t "f = â—†Parser p â—‡string a â—‡int b ->"       , "â–ª[(â—†name = (â—†[(â—†type(Parser) â—†name), (â—‡type(string) â—†name), (â—‡type(int) â—†name)] ->))]"
        t "f = â—†Parser p ->"                        , "â–ª[(â—†name = (â—†[(â—†type(Parser) â—†name)] ->))]"
        t "f = âœNode ->"                            , "â–ª[(â—†name = ( âœ type(Node) ->))]"
        t "f = â—†Parser p âœNode ->"                  , "â–ª[(â—†name = (â—†[(â—†type(Parser) â—†name)] âœ type(Node) ->))]"
        t "f = â—‡seq[Node] s âœseq[Node] ->"          , "â–ª[(â—†name = (â—†[(â—‡type(seq[Node]) â—†name)] âœ type(seq[Node]) ->))]"

        t "f = â—‡Parser p â—‡int ahead=1 âœToken ->"    , "â–ª[(â—†name = (â—†[(â—‡type(Parser) â—†name), (â—‡type(int) â—†name (= â—†number))] âœ type(Token) ->))]"
        t "f = â—‡int i ->"                           , "â–ª[(â—†name = (â—†[(â—‡type(int) â—†name)] ->))]"
        t "f = â—‡int a â—‡int b ->"                    , "â–ª[(â—†name = (â—†[(â—‡type(int) â—†name), (â—‡type(int) â—†name)] ->))]"
        t "f = â—‡int a = 1 ->"                       , "â–ª[(â—†name = (â—†[(â—‡type(int) â—†name (= â—†number))] ->))]"
        
        t "f = a=1 b=2 ->"                          , "â–ª[(â—†name = (â—†[(â—‡ â—†name (= â—†number)), (â—‡ â—†name (= â—†number))] ->))]" 
        t "f = â—‡Parser p ahead=1 ->"                , "â–ª[(â—†name = (â—†[(â—‡type(Parser) â—†name), (â—‡ â—†name (= â—†number))] ->))]"
        t "f = â—‡Parser p ahead=1 âœToken ->"         , "â–ª[(â—†name = (â—†[(â—‡type(Parser) â—†name), (â—‡ â—†name (= â—†number))] âœ type(Token) ->))]"
        
    â–¸ func modfifier
    
        t "{.noconv.}"                              , "â–ª[{.]"
        t "() -> {.noconv.}"                        , "â–ª[(â—†[] -> {.noconv.} )]"
        t "a = () -> {.noconv.}"                    , "â–ª[(â—†name = (â—†[] -> {.noconv.} ))]"
        t "setHook(() -> {.noconv.}\n  1 + 2)"      , "â–ª[(â—†name â—†call @[(â—†[] -> {.noconv.}  â–ª[(â—†number + â—†number)])])]"
        
    â–¸ func body
    
        t "f = ->\n  b = 1 + 2\n  b += 3"           , "â–ª[(â—†name = (-> â–ª[(â—†name = (â—†number + â—†number))(â—†name += â—†number)]))]" 
        
    â–¸ call
    
        t "f()"                                     , "â–ª[(â—†name â—†call @[])]"
        t "f(g())"                                  , "â–ª[(â—†name â—†call @[(â—†name â—†call @[])])]"
        t "f(g() / h())"                            , "â–ª[(â—†name â—†call @[((â—†name â—†call @[]) / (â—†name â—†call @[]))])]"
        t "f(1)"                                    , "â–ª[(â—†name â—†call @[â—†number])]"
        t "f(1 + 2)"                                , "â–ª[(â—†name â—†call @[(â—†number + â—†number)])]"
        t "f(1 + 2 4 + 5)"                          , "â–ª[(â—†name â—†call @[(â—†number + â—†number), (â—†number + â—†number)])]"
        t "f(1 2 3)"                                , "â–ª[(â—†name â—†call @[â—†number, â—†number, â—†number])]"
        t "f(1 g(h(2)))"                            , "â–ª[(â—†name â—†call @[â—†number, (â—†name â—†call @[(â—†name â—†call @[â—†number])])])]"
    
    â–¸ implicit call    
    
        t "f a"                                     , "â–ª[(â—†name â—†call @[â—†name])]"
        t "f a.b"                                   , "â–ª[(â—†name â—†call @[(â—†name . â—†name)])]"
        t "f a.b, c"                                , "â–ª[(â—†name â—†call @[(â—†name . â—†name), â—†name])]"
        t "f a.b c"                                 , "â–ª[(â—†name â—†call @[(â—†name . â—†name), â—†name])]"
        t "f(a.b c)"                                , "â–ª[(â—†name â—†call @[(â—†name . â—†name), â—†name])]"
        t "f a.b(c)"                                , "â–ª[(â—†name â—†call @[((â—†name . â—†name) â—†call @[â—†name])])]"
        t "f a[0] c"                                , "â–ª[(â—†name â—†call @[(â—†name[â—†number]), â—†name])]"
        t "f(a[0] c)"                               , "â–ª[(â—†name â—†call @[(â—†name[â—†number]), â—†name])]"
        
        t "f 1 '2' false"                           , "â–ª[(â—†name â—†call @[â—†number, â—†string, âœ˜])]"
        
        t "let r = read(fd, addr(line[0]), l.len)"  , "â–ª[(â—†let (â—†name = (â—†name â—†call @[â—†name, (â—†name â—†call @[(â—†name[â—†number])]), (â—†name . â—†name)])))]"
        
        t "read(fd, 1)"                             , "â–ª[(â—†name â—†call @[â—†name, â—†number])]" 
        t "read(fd 1)"                              , "â–ª[(â—†name â—†call @[â—†name, â—†number])]" 
        t "read fd, 1"                              , "â–ª[(â—†name â—†call @[â—†name, â—†number])]" 
        # t "read fd 1"                               , "â–ª[(â—†name â—†call @[â—†name, â—†number])]" 
        # t "read(fd addr(line[0]) line.len)"         , "â–ª[(â—†name â—†call @[â—†name, (â—†name â—†call @[(â—†name[â—†number])]), (â—†name . â—†name)])]" 
        # t "read fd addr 1"                         , "â–ª[(â—†name â—†call @[â—†name, â—†name â—†number])]"
        # t "read fd addr(line[0]) l.len"            , "â–ª[(â—†name â—†call @[â—†name, (â—†name â—†call @[(â—†name[â—†number])]), (â—†name . â—†name)])]"
        # t "let r = read fd addr(line[0]) l.len"    , "â–ª[(â—†let (â—†name = (â—†name â—†call @[â—†name, (â—†name â—†call @[(â—†name[â—†number])]), (â—†name . â—†name)])))]"
        
    â–¸ arglist
    
        t "f(a, b, c)"                              , "â–ª[(â—†name â—†call @[â—†name, â—†name, â—†name])]"
        t "f a, b, c"                               , "â–ª[(â—†name â—†call @[â—†name, â—†name, â—†name])]"
        t "(a, b, c) = f()"                         , "â–ª[(â—†[â—†name, â—†name, â—†name] = (â—†name â—†call @[]))]"
        # Ïğš’ğ“â«™Ïµ!
        # t "(a b c) = f()"                         , "â–ª[(@[â—†name, â—†name, â—†name] = (â—†name â—†call @[]))]"
        
    â–¸ assign
    
        t "a = 1"                                   , "â–ª[(â—†name = â—†number)]"
        t "a = b = 1"                               , "â–ª[(â—†name = (â—†name = â—†number))]"
        t "a = b = c = 2"                           , "â–ª[(â—†name = (â—†name = (â—†name = â—†number)))]"
        
        t "(a, b) = c"                              , "â–ª[(â—†[â—†name, â—†name] = â—†name)]"
        t "(a b) = c"                               , "â–ª[(â—†[â—†name, â—†name] = â—†name)]"
        # let (dir name ext) = 
        
    â–¸ property access        
        
        t "a.b"                                     , "â–ª[(â—†name . â—†name)]"
        t "a.b.c"                                   , "â–ª[((â—†name . â—†name) . â—†name)]"
        t "a.b()"                                   , "â–ª[((â—†name . â—†name) â—†call @[])]"
        t "a.b().c"                                 , "â–ª[(((â—†name . â—†name) â—†call @[]) . â—†name)]"
        
    â–¸ array access
    
        t "a[0]"                                    , "â–ª[(â—†name[â—†number])]"
        
    â–¸ if
    
        t "if true then â®  false"                   , "â–ª[(â—†if @[(âœ” (â® âœ˜))])]"
        t "if true then â®  1 else â®  2"             , "â–ª[(â—†if @[(âœ” (â® â—†number))] (â® â—†number))]"
        t "if a âœ 1 elif b âœ 2 elif c âœ 3"          , "â–ª[(â—†if @[(â—†name â—†number), (â—†name â—†number), (â—†name â—†number)])]"
        t "if a âœ 1 elif b âœ 2 elif c âœ 3 else 4"   , "â–ª[(â—†if @[(â—†name â—†number), (â—†name â—†number), (â—†name â—†number)] â—†number)]"
        t "if\n  a âœ 1\n  b âœ 2\n  c âœ 3"           , "â–ª[(â—†if @[(â—†name â—†number), (â—†name â—†number), (â—†name â—†number)])]"
        t "if\n  a âœ 1\n  b âœ 2\n  c âœ 3\n  âœ 4"    , "â–ª[(â—†if @[(â—†name â—†number), (â—†name â—†number), (â—†name â—†number)] â—†number)]"
        
        t "if a then if b then 1 else 2 else 3"     , "â–ª[(â—†if @[(â—†name (â—†if @[(â—†name â—†number)] â—†number))] â—†number)]"
        t "x = if a then b else c"                  , "â–ª[(â—†name = (â—†if @[(â—†name â—†name)] â—†name))]"
        t "x = if a then b else c+d"                , "â–ª[(â—†name = (â—†if @[(â—†name â—†name)] (â—†name + â—†name)))]"
        
        t "if a then â®"                             , "â–ª[(â—†if @[(â—†name (â®))])]"
        t "a + if b then c else d"                  , "â–ª[(â—†name + (â—†if @[(â—†name â—†name)] â—†name))]"
        
        t "if true\n  log msg"                      , "â–ª[(â—†if @[(âœ” â–ª[(â—†name â—†call @[â—†name])])])]"
        t "if true\n  log(1)\n  log(2)"             , "â–ª[(â—†if @[(âœ” â–ª[(â—†name â—†call @[â—†number])(â—†name â—†call @[â—†number])])])]"
        
        t "if a âœ 1\nelif b == 2 âœ 2"               , "â–ª[(â—†if @[(â—†name â—†number), ((â—†name == â—†number) â—†number)])]"
        
    â–¸ for
    
        t "0..2"                                    , "â–ª[(â—†number .. â—†number)]"
        t "for a in 0..2 âœ true"                    , "â–ª[(â—†for â—†name in (â—†number .. â—†number) âœ”)]"
        t "for a in 0..2\n  true"                   , "â–ª[(â—†for â—†name in (â—†number .. â—†number) â–ª[âœ”])]"
        t "for a in 0..2 âœ\n  true"                 , "â–ª[(â—†for â—†name in (â—†number .. â—†number) â–ª[âœ”])]"
        t "for key val in a"                        , "â–ª[(â—†for â—†[â—†name, â—†name] in â—†name)]"  
        t "for kind, key, val in a"                 , "â–ª[(â—†for â—†[â—†name, â—†name, â—†name] in â—†name)]"  
        
    â–¸ switch
    
        t "switch x\n  a âœ 1\n  b c âœ 2"            , "â–ª[(â—†switch â—†name @[(@[â—†name] â—†number), (@[â—†name, â—†name] â—†number)])]"
        t "switch x\n  a âœ 1\n  b c âœ 2\n  âœ 4"     , "â–ª[(â—†switch â—†name @[(@[â—†name] â—†number), (@[â—†name, â—†name] â—†number)] â—†number)]"

        t "switch x\n  1 2 âœ a"                     , "â–ª[(â—†switch â—†name @[(@[â—†number, â—†number] â—†name)])]"
        t "switch x\n  1 2 âœ a\n  3 âœ b"            , "â–ª[(â—†switch â—†name @[(@[â—†number, â—†number] â—†name), (@[â—†number] â—†name)])]"
        t "switch x\n  1 2 âœ a\n  3 âœ b\n  else c"  , "â–ª[(â—†switch â—†name @[(@[â—†number, â—†number] â—†name), (@[â—†number] â—†name)] â—†name)]"
        t "switch x\n  1 2 âœ a\n  3 âœ b\n  âœ c"     , "â–ª[(â—†switch â—†name @[(@[â—†number, â—†number] â—†name), (@[â—†number] â—†name)] â—†name)]"
        t "switch x\n  1 2\n    a\n  âœ c"           , "â–ª[(â—†switch â—†name @[(@[â—†number, â—†number] â–ª[â—†name])] â—†name)]"
        t "switch x\n  1 2âœ\n    a\n  âœ c"          , "â–ª[(â—†switch â—†name @[(@[â—†number, â—†number] â–ª[â—†name])] â—†name)]"
        t "switch x\n  1 2 âœ a\n  else\n    c"      , "â–ª[(â—†switch â—†name @[(@[â—†number, â—†number] â—†name)] â—†name)]"
        t "switch x\n  1 2 âœ a\n  âœ\n    c"         , "â–ª[(â—†switch â—†name @[(@[â—†number, â—†number] â—†name)] â—†name)]"
        t "switch x\n a âœ if b then c"              , "â–ª[(â—†switch â—†name @[(@[â—†name] (â—†if @[(â—†name â—†name)]))])]"
        
    â–¸ while
    
        t "while true"                              , "â–ª[(â—†while âœ”)]"
        t "while false âœ 1"                         , "â–ª[(â—†while âœ˜ â—†number)]"
        t "while false âœ\n 1"                       , "â–ª[(â—†while âœ˜ â–ª[â—†number])]"
        t "while false\n 1"                         , "â–ª[(â—†while âœ˜ â–ª[â—†number])]"
        t "while 2\n continue"                      , "â–ª[(â—†while â—†number â–ª[â—†continue])]"
        t "while 2\n break"                         , "â–ª[(â—†while â—†number â–ª[â—†break])]"
        
    â–¸ strings
    
        t "s = \"hello\""                           , "â–ª[(â—†name = â—†string)]"
        t "s = \"\"\"hello\"\"\""                   , "â–ª[(â—†name = â—†string)]"
        t "s = \"\"\"\n\n\"\"\""                    , "â–ª[(â—†name = â—†string)]"
        t "s = \"\"\"num #{1+2} end\"\"\""          , "â–ª[(â—†name = â—†string#{@[(â—†number + â—†number)]})]"
        t "s = \"\"\"\nl1 #{1}\nl2 #{2}\"\"\""      , "â–ª[(â—†name = â—†string#{@[â—†number] @[â—†number]})]"
        
        t "\"a #{1} e\""                            , "â–ª[â—†string#{@[â—†number]}]"
        t "\"a #{1}\""                              , "â–ª[â—†string#{@[â—†number]}]"
        t "\"#{1}\""                                , "â–ª[â—†string#{@[â—†number]}]"
        
    â–¸ toplevel

        t ""                                        , "â–ª[]"
        t "42"                                      , "â–ª[â—†number]"
        t "true"                                    , "â–ª[âœ”]"
        t "false"                                   , "â–ª[âœ˜]"
        t "\"hello\""                               , "â–ª[â—†string]"
        
    â–¸ use
    
        t "use rndr"                                , "â–ª[(â—†use â—†name)]"
        t "use std â–ª unittest"                      , "â–ª[(â—†use â—†name â–ª @[â—†name])]"
        t "use ../rndr"                             , "â–ª[(â—†use â—†name)]"
        t "use std â–ª os logging\nuse kommon"        , "â–ª[(â—†use â—†name â–ª @[â—†name, â—†name])(â—†use â—†name)]"
        t "use std â–ª a b c\nuse d\nuse e\nuse f"    , "â–ª[(â—†use â—†name â–ª @[â—†name, â—†name, â—†name])(â—†use â—†name)(â—†use â—†name)(â—†use â—†name)]" 

        t "import ../../rel/[s1, s2]"               , "â–ª[â—†import]"
        
    â–¸ tests
    
        t "â–¸ a test suite"                          , "â–ª[(â–¸ suite)]"
        check ast("â–¸ a test suite").expressions[0].kind      == â—testSuite
        
        t "    â–¸ test section"                      , "â–ª[(â–¸ section)]"
        check ast("    â–¸ test section").expressions[0].kind  == â—testSection
        
        t "    f(a) â–¸ 42"                           , "â–ª[((â—†name â—†call @[â—†name]) â–¸ â—†number)]"
        t "    f(a) â–¸\n        42"                  , "â–ª[((â—†name â—†call @[â—†name]) â–¸ â—†number)]"
        
        t "â–¸ suite\n  â–¸ test"                       , "â–ª[(â–¸ suite â–ª[(â–¸ section)])]"
        
        t """
â–¸ rndr
   â–¸ toplevel
       rndr("")   â–¸ ""
       rndr("42") â–¸ "42" """  , "â–ª[(â–¸ suite â–ª[(â–¸ section â–ª[((â—†name â—†call @[â—†string]) â–¸ â—†string)((â—†name â—†call @[â—†string]) â–¸ â—†string)])])]"

    â–¸ blocks
    
        t """
f = -> 
    if x
        2
    1
"""  , "â–ª[(â—†name = (-> â–ª[(â—†if @[(â—†name â–ª[â—†number])])â—†number]))]"

        t """
f = -> 
    g = -> 
        2
        2
    1
"""  , "â–ª[(â—†name = (-> â–ª[(â—†name = (-> â–ª[â—†numberâ—†number]))â—†number]))]"

        t """
f = -> 
    g = -> 
        2
        2
    1
0
0"""  , "â–ª[(â—†name = (-> â–ª[(â—†name = (-> â–ª[â—†numberâ—†number]))â—†number]))â—†numberâ—†number]"

        t """
icon = 
    if ex == ".kim"
        "î·«  "
    else
        "î¡  """"  , "â–ª[(â—†name = â–ª[(â—†if @[((â—†name == â—†string) â–ª[â—†string])] â–ª[â—†string])])]"
        