###
     0000000  000000000   0000000   000000000  00000000  
    000          000     000   000     000     000       
    0000000      000     000000000     000     0000000   
         000     000     000   000     000     000       
    0000000      000     000   000     000     00000000  
###

use edit.tool.belt
use edit.state
use edit.mode

cells = {cols:55 rows:66}
s = state cells 'test'

txt = t     -> kseg.str(s.s.lines) ‚ñ∏ t
cur = x y   -> s‚àômainCursor() ‚ñ∏ [x y]
mul = (...) -> s‚àôallCursors() ‚ñ∏ array.from({...})
sel = (...) -> s‚àôallSelections() ‚ñ∏ array.from({...})

‚ñ∏ state
    
    text = """
        line 1
        line 2
        line 3
        """
    
    s.syntax.ext = 'kode'
    
    s‚àôloadSegls belt.seglsForText(text)
    
    txt text
    
    belt.seglsForText(text) ‚ñ∏ belt.seglsForText(text) 
    belt.linesForText(text) ‚ñ∏ ["line 1" "line 2" "line 3" ""]
    kseg.segls(belt.linesForText(text)) ‚ñ∏ belt.seglsForText(text) 
    
    s‚àôloadLines belt.linesForText(text)
     
    txt text
    
    # 00000000  0000000    000  000000000  000  000   000   0000000   
    # 000       000   000  000     000     000  0000  000  000        
    # 0000000   000   000  000     000     000  000 0 000  000  0000  
    # 000       000   000  000     000     000  000  0000  000   000  
    # 00000000  0000000    000     000     000  000   000   0000000   
    
    ‚ñ∏ editing
    
        s‚àôloadSegls belt.seglsForText(text)
        
        txt text
        
        s‚àôsetMainCursor 2 2
        
        cur 2 2
        
        s‚àôinsert 'x'
        
        txt """
            line 1
            lxine 2
            line 3
            """    
        cur 3 2

        s‚àôdelete 'back'
        
        cur 2 2
        txt text

    ‚ñ∏ moveCursors
    
        s‚àôloadSegls belt.seglsForText(text)
        
        s‚àôsetMainCursor 2 2
        
        s‚àômoveCursors 'left'
        
        cur 1 2
        
        s‚àômoveCursors 'right' {jump:['ws' 'word' 'empty' 'punct']}
        
        cur 5 2
        
        s‚àômoveCursors 'right' {jump:['ws' 'word' 'empty' 'punct']}
        
        cur 6 2

        s‚àômoveCursors 'right' {jump:['ws' 'word' 'empty' 'punct']}
        
        cur 7 2

        s‚àômoveCursors 'right' {jump:['ws' 'word' 'empty' 'punct']}
        
        cur 8 2

        s‚àômoveCursors 'right' {jump:['ws' 'word' 'empty' 'punct']}
        
        cur 9 2

        s‚àômoveCursors 'left' {jump:['ws' 'word' 'empty' 'punct']}
        
        cur 7 2
        
        s‚àômoveCursors ['bos' 'ind_bol']
        
        cur 1 2
        
        s‚àômoveCursors ['eos' 'ind_eol']
        
        cur 7 2
        
    # 00     00   0000000   000   000  00000000        000      000  000   000  00000000   0000000  
    # 000   000  000   000  000   000  000             000      000  0000  000  000       000       
    # 000000000  000   000   000 000   0000000         000      000  000 0 000  0000000   0000000   
    # 000 0 000  000   000     000     000             000      000  000  0000  000            000  
    # 000   000   0000000       0      00000000        0000000  000  000   000  00000000  0000000   
    
    ‚ñ∏ move lines
    
        s‚àôloadSegls belt.seglsForText(text)
        s‚àôsetMainCursor 2 2
    
        s‚àômoveSelectionOrCursorLines 'up'
        cur 2 1
        txt """
            line 2
            line 1
            line 3
            """
        s‚àômoveSelectionOrCursorLines 'down'
        
        cur 2 2
        txt """
            line 1
            line 2
            line 3
            """
            
    ‚ñ∏ insert
    
        s‚àôloadSegls belt.seglsForText(text)
        s‚àôsetMainCursor 1 2
        s‚àôinsert "\n"
        cur 1 3
        
        txt """
            line 1
            
            line 2
            line 3
            """

        s‚àôloadSegls belt.seglsForText(text)
        s‚àôsetMainCursor 6 2
        s‚àôinsert "\n"
        cur 1 3
        
        txt """
            line 1
            line 
            2
            line 3
            """
        
    # 00     00  000   000  000      000000000  000  00000000   000      00000000  
    # 000   000  000   000  000         000     000  000   000  000      000       
    # 000000000  000   000  000         000     000  00000000   000      0000000   
    # 000 0 000  000   000  000         000     000  000        000      000       
    # 000   000   0000000   0000000     000     000  000        0000000  00000000  
    
    ‚ñ∏ multiple
    
        s‚àôloadSegls belt.seglsForText(text)
        
        s‚àôsetMainCursor 1 2
        s‚àôexpandCursors   'up'
        
        mul [1 1] [1 2]
        
        s‚àôexpandCursors   'down'
        
        mul [1 1] [1 2] [1 3]
        
        s‚àômoveCursors 'left'
        
        mul [1 1] [1 2] [1 3]
        
        s‚àômoveCursorsAndSelect 'right'
        
        mul [2 1] [2 2] [2 3]
        sel [1 1 2 1] [1 2 2 2] [1 3 2 3]
        
        s‚àômoveCursors 'right' {jump:['ws' 'word' 'empty' 'punct']}
        
        mul [5 1] [5 2] [5 3]
        sel [1 1 2 1] [1 2 2 2] [1 3 2 3]
        
        s‚àôselectAllLines()
         
        mul [5 1] [5 2] [5 3]
        sel [1 1 1 4]

        s‚àôselectAllLines()
        
        mul [5 1] [5 2] [5 3]
        sel()
         
        s‚àômoveCursors 'right'
        s‚àômoveCursorsAndSelect 'left' {jump:['word']}
        sel [5 1 6 1] [5 2 6 2] [5 3 6 3]
        
        s‚àômoveCursorsAndSelect 'left' {jump:['word']}
        
        mul [1 1] [1 2] [1 3]
        sel [1 1 6 1] [1 2 6 2] [1 3 6 3]
        
        #s‚àôinsert '\n' 
        #
        #mul [0 1] [0 3] [0 5]
        #sel()
        #txt """
        #    
        #    1
        #    
        #    2
        #    
        #    3
        #    """    
            
    # 000   000  000   000  000   0000000   0000000   0000000    00000000  
    # 000   000  0000  000  000  000       000   000  000   000  000       
    # 000   000  000 0 000  000  000       000   000  000   000  0000000   
    # 000   000  000  0000  000  000       000   000  000   000  000       
    #  0000000   000   000  000   0000000   0000000   0000000    00000000  
    
    #‚ñ∏ unicode
    #
    #    text = """
    #        s = "üßëüåæ"
    #        line 3
    #        """
    #    
    #    s.syntax.ext = 'kode'
    #    s‚àôloadSegls belt.seglsForText(text)
    #            
    #    txt text
    #    
    #    s‚àôtoggleCommentAtSelectionOrCursorLines()
    #
    #    txt """
    #        # s = "üßëüåæ"
    #        line 3
    #        """
    #    s‚àôtoggleCommentAtSelectionOrCursorLines()
    #    
    #    txt text
    #    
    #    ‚ñ∏ selection
    #    
    #        text = """
    #            'a'        ‚ñ∏ 1
    #            'üîß'       ‚ñ∏ 2
    #            'Â≠ó'       ‚ñ∏ 2
    #            'Â≠óÁöÑÊ®°Âùó' ‚ñ∏ 8
    #            'üëÅ'        ‚ñ∏ 1
    #            'üñå'        ‚ñ∏ 1
    #            'üõ†'        ‚ñ∏ 1
    #            'üßë‚Äçüåæ'       ‚ñ∏ 4
    #            'üî•'       ‚ñ∏ 2
    #            'üí©'       ‚ñ∏ 2
    #            """
    #
    #        s.syntax.ext = 'kode'
    #        s‚àôloadSegls belt.seglsForText(text)
    #                
    #        txt text 
    #        
    #        s‚àôselectAllLines()
    #        
    #        sel [1 1 15 10]
    #        
    #        s‚àômoveCursorsToEndOfSelections()
    #        
    #        sel [1 1 15 10]
    #        mul [15 1] [15 2] [15 3] [15 4] [15 5] [15 6] [15 7] [15 8] [15 9] [15 10]
    #        
    #        s‚àôdeselect()
    #        
    #        sel()
    #        mul [15 1] [15 2] [15 3] [15 4] [15 5] [15 6] [15 7] [15 8] [15 9] [15 10]
    #
    #        s‚àômoveCursors 'bol'
    #        
    #        mul [1 1] [1 2] [1 3] [1 4] [1 5] [1 6] [1 7] [1 8] [1 9] [1 10]
    #
    #        s‚àôselectMoreLines()
    #        
    #        sel [1 1 15 10]
    #        mul [15 1] [15 2] [15 3] [15 4] [15 5] [15 6] [15 7] [15 8] [15 9] [15 10]
    #
    #        s‚àôdeselect()
    #        s‚àôdelete 'back'
    #        
    #        txt """
    #            'a'        ‚ñ∏ 
    #            'üîß'       ‚ñ∏ 
    #            'Â≠ó'       ‚ñ∏ 
    #            'Â≠óÁöÑÊ®°Âùó' ‚ñ∏ 
    #            'üëÅ'        ‚ñ∏ 
    #            'üñå'        ‚ñ∏ 
    #            'üõ†'        ‚ñ∏ 
    #            'üßë‚Äçüåæ'       ‚ñ∏ 
    #            'üî•'       ‚ñ∏ 
    #            'üí©'       ‚ñ∏ 
    #            """
    #
    #        s‚àôdelete 'back'
    #        s‚àômoveCursors 'left'
    #        s‚àôdelete 'back'
    #
    #        txt """
    #            'a'       ‚ñ∏
    #            'üîß'      ‚ñ∏
    #            'Â≠ó'      ‚ñ∏
    #            'Â≠óÁöÑÊ®°Âùó'‚ñ∏
    #            'üëÅ'       ‚ñ∏
    #            'üñå'       ‚ñ∏
    #            'üõ†'       ‚ñ∏
    #            'üßë‚Äçüåæ'      ‚ñ∏
    #            'üî•'      ‚ñ∏
    #            'üí©'      ‚ñ∏
    #            """
    #            
    #        s‚àôdelete 'back' true
    #
    #        txt """
    #            'a'‚ñ∏
    #            'üîß'‚ñ∏
    #            'Â≠ó'‚ñ∏
    #            'Â≠óÁöÑÊ®°Âùó‚ñ∏
    #            'üëÅ'‚ñ∏
    #            'üñå'‚ñ∏
    #            'üõ†'‚ñ∏
    #            'üßë‚Äçüåæ'‚ñ∏
    #            'üî•'‚ñ∏
    #            'üí©'‚ñ∏
    #            """
            
    # 00000000  00     00  00000000   000000000  000   000  
    # 000       000   000  000   000     000      000 000   
    # 0000000   000000000  00000000      000       00000    
    # 000       000 0 000  000           000        000     
    # 00000000  000   000  000           000        000     
    
    ‚ñ∏ empty
    
        # s.syntax.ext = 'kode'
        # s‚àôloadLines belt.linesForText('')
        # 
        # txt ''
        # cur 1 1
        
        #s‚àôinsert '\n'
        #
        #txt '\n'
        #cur 1 2
        #
        #s.s.lines ‚ñ∏ [[] []]
        
    # 0000000    00000000  000      00000000  000000000  00000000        0000000     0000000    0000000  000   000  
    # 000   000  000       000      000          000     000             000   000  000   000  000       000  000   
    # 000   000  0000000   000      0000000      000     0000000         0000000    000000000  000       0000000    
    # 000   000  000       000      000          000     000             000   000  000   000  000       000  000   
    # 0000000    00000000  0000000  00000000     000     00000000        0000000    000   000   0000000  000   000  
    
    ‚ñ∏ delete back
    
        s.syntax.ext = 'kode'
        s‚àôloadLines belt.linesForText("1234567890")
        
        s‚àôsetMainCursor 1 1 
        s‚àôdelete 'back'
        txt "1234567890"
        mul [1 1]
        
        s‚àôsetMainCursor 2 1 
        s‚àôdelete 'back'
        txt "234567890"
        mul [1 1]
        
        s‚àôsetMainCursor 5 1 
        s‚àôdelete 'back'
        txt "23467890"
        mul [4 1]
        
        s‚àôdelete 'back'
        txt "2367890"
        mul [3 1]
                        
        s‚àôloadSegls kseg.segls ("xxxx         .  2")
        s‚àôsetMainCursor 17 1
        s‚àôdelete 'back'
        mul [15 1]
        txt "xxxx         .2"
        
        text = """
            xxxx            1
            xxxx         .  2
            xxxx    .       3
            """
        
        s‚àôloadLines belt.linesForText(text)
        
        s‚àôsetMainCursor 17 1 
        s‚àôexpandCursors 'down'
        s‚àôexpandCursors 'down'
        
        mul [17 1] [17 2] [17 3]
        
        s‚àôdelete 'back'
        mul [15 1] [15 2] [15 3]
        txt """
            xxxx          1
            xxxx         .2
            xxxx    .     3
            """

        s‚àôdelete 'back'
        mul [14 1] [14 2] [14 3]

        txt """
            xxxx         1
            xxxx         2
            xxxx    .    3
            """
            
        s‚àôdelete 'back'
        mul [13 1] [13 2] [13 3]

        txt """
            xxxx        1
            xxxx        2
            xxxx    .   3
            """

        s‚àôdelete 'back'
        mul [10 1] [10 2] [10 3]

        txt """
            xxxx     1
            xxxx     2
            xxxx    .3
            """
        
        s‚àôdelete 'back'
        mul [9 1] [9 2] [9 3]

        txt """
            xxxx    1
            xxxx    2
            xxxx    3
            """
        
        s‚àôdelete 'back'
        mul [5 1] [5 2] [5 3]

        txt """
            xxxx1
            xxxx2
            xxxx3
            """
                
    #  0000000  000       0000000   000   000  00000000         000      000  000   000  00000000   0000000  
    # 000       000      000   000  0000  000  000              000      000  0000  000  000       000       
    # 000       000      000   000  000 0 000  0000000          000      000  000 0 000  0000000   0000000   
    # 000       000      000   000  000  0000  000              000      000  000  0000  000            000  
    #  0000000  0000000   0000000   000   000  00000000         0000000  000  000   000  00000000  0000000   
    
    ‚ñ∏ cloneSelectionAndCursorLines
    
        text = """
            line 1
            line 2
            line 3
            """
        s‚àôloadLines belt.linesForText(text)
        s‚àôcloneSelectionAndCursorLines 'down'
        
        txt """
            line 1
            line 1
            line 2
            line 3
            """
            
        mul [1 2]
            
        s‚àôexpandCursors 'down'
        
        mul [1 2] [1 3]
        
        s‚àôcloneSelectionAndCursorLines 'down'
         
        txt """
            line 1
            line 1
            line 2
            line 1
            line 2
            line 3
            """
            
        mul [1 4] [1 5] 
        
        s‚àôexpandCursors 'down'
        s‚àômoveCursors 'right'
        
        mul [2 4] [2 5] [2 6] 
        
        s‚àôcloneSelectionAndCursorLines 'down'
            
        txt """
            line 1
            line 1
            line 2
            line 1
            line 2
            line 3
            line 1
            line 2
            line 3
            """
            
    # 0000000    00000000  000            00000000    0000000   000   000   0000000   00000000   0000000  
    # 000   000  000       000            000   000  000   000  0000  000  000        000       000       
    # 000   000  0000000   000            0000000    000000000  000 0 000  000  0000  0000000   0000000   
    # 000   000  000       000            000   000  000   000  000  0000  000   000  000            000  
    # 0000000    00000000  0000000        000   000  000   000  000   000   0000000   00000000  0000000   
    
    ‚ñ∏ deleteRanges
    
        text = """
            line 1
            line 2
            line 3
            """
            
        s‚àôloadLines belt.linesForText(text)
        s‚àôdeleteRanges [[1 1 3 1]] 
        
        txt """
            ne 1
            line 2
            line 3
            """
            
        s‚àôdeleteRanges [[3 1 3 2]]
    
        txt """
            nene 2
            line 3
            """
            
        s‚àôdeleteRanges [[7 1 1 2]]
    
        txt """
            nene 2line 3
            """
        
    #       000   0000000   000  000   000        000      000  000   000  00000000   0000000  
    #       000  000   000  000  0000  000        000      000  0000  000  000       000       
    #       000  000   000  000  000 0 000        000      000  000 0 000  0000000   0000000   
    # 000   000  000   000  000  000  0000        000      000  000  0000  000            000  
    #  0000000    0000000   000  000   000        0000000  000  000   000  00000000  0000000   
    
    ‚ñ∏ joinLines
    
        text = """
            line 1
            line 2
            line 3
            """
            
        s‚àôloadLines belt.linesForText(text)            
        s‚àôsetMainCursor 1 1 
        mul [1 1]
        s‚àôjoinLines()

        txt """
            line 1line 2
            line 3
            """
            