###
000000000  00000000   0000000  000000000          000   000   0000000  00000000   0000000   
   000     000       000          000             000  000   000       000       000        
   000     0000000   0000000      000             0000000    0000000   0000000   000  0000  
   000     000            000     000             000  000        000  000       000   000  
   000     00000000  0000000      000     000000  000   000  0000000   00000000   0000000   
###

use .. ‚óÜ kstr kseg

‚ñ∏ kseg

    hello = """
        hello
        world
        """
        
    ‚ñ∏ kseg
    
        kseg hello ‚ñ∏ ['h' 'e' 'l' 'l' 'o' '\n' 'w' 'o' 'r' 'l' 'd']
        
    #  0000000  00000000   0000000   000       0000000  
    # 000       000       000        000      000       
    # 0000000   0000000   000  0000  000      0000000   
    #      000  000       000   000  000           000  
    # 0000000   00000000   0000000   0000000  0000000   
    
    ‚ñ∏ segls
    
        kseg.segls hello ‚ñ∏ [['h' 'e' 'l' 'l' 'o'] ['w' 'o' 'r' 'l' 'd']]
        kseg.segls kseg.segls(hello) ‚ñ∏ [['h' 'e' 'l' 'l' 'o'] ['w' 'o' 'r' 'l' 'd']]
        kseg.segls """
            aaa
            
            bbb
            """ ‚ñ∏ [['a' 'a' 'a'] [] ['b' 'b' 'b']]
            
    #  0000000  000000000  00000000   
    # 000          000     000   000  
    # 0000000      000     0000000    
    #      000     000     000   000  
    # 0000000      000     000   000  
    
    ‚ñ∏ str
    
        kseg.str kseg('hello') ‚ñ∏ 'hello'
        kseg.str kseg('hello\world') ‚ñ∏ 'hello\world'
        kseg.str kseg.segls(hello) ‚ñ∏ hello
        
    #       000   0000000   000  000   000  
    #       000  000   000  000  0000  000  
    #       000  000   000  000  000 0 000  
    # 000   000  000   000  000  000  0000  
    #  0000000    0000000   000  000   000  
    
    ‚ñ∏ join
        
        kseg.join 'hello' '!' '?'   ‚ñ∏ kseg 'hello!?'
        kseg.join kseg('hello') '!' ‚ñ∏ kseg 'hello!'
        kseg.join 'hello' kseg('!') ‚ñ∏ kseg 'hello!'
        kseg.join kseg.segls('hello') kseg.segls('world') ‚ñ∏ kseg.segls("hello\nworld")
        kseg.join kseg.segls('hello') kseg('world') ‚ñ∏ kseg.segls('hello').concat kseg('world') # attention! result is mixed for mixed input!
    
    # 000      000  000   000  00000000   0000000  
    # 000      000  0000  000  000       000       
    # 000      000  000 0 000  0000000   0000000   
    # 000      000  000  0000  000            000  
    # 0000000  000  000   000  00000000  0000000   
    
    ‚ñ∏ lines
        
        kseg.lines ''    ‚ñ∏ lines:['']   segls:[[]]
        kseg.lines ' '   ‚ñ∏ lines:[' ']  segls:[[' ']]
        kseg.lines 'a'   ‚ñ∏ lines:['a']  segls:[['a']]
        kseg.lines hello ‚ñ∏ lines:kstr.lines(hello) segls:[kseg('hello') kseg('world')]

    # 0000000    00000000  000000000   0000000   0000000    
    # 000   000  000          000     000   000  000   000  
    # 000   000  0000000      000     000000000  0000000    
    # 000   000  000          000     000   000  000   000  
    # 0000000    00000000     000     000   000  0000000    
    
    ‚ñ∏ detab
    
        kseg.detab(kseg("ta\tb\tb\ty")) ‚ñ∏ kseg("ta  b   b   y")
    
    #  0000000  000   000  000   000  000   000  000   000   0000000  
    # 000       000   000  000   000  0000  000  000  000   000       
    # 000       000000000  000   000  000 0 000  0000000    0000000   
    # 000       000   000  000   000  000  0000  000  000        000  
    #  0000000  000   000   0000000   000   000  000   000  0000000   
    
    ‚ñ∏ chunks
    
        kseg.chunks 'a'      ‚ñ∏ [chunk:'a' index:0 segl:['a']]
        kseg.chunks ' a'     ‚ñ∏ [chunk:'a' index:1 segl:['a']]
        kseg.chunks 'ab cd'  ‚ñ∏ [{chunk:'ab' index:0 segl:['a' 'b']}, {chunk:'cd' index:3 segl:['c' 'd']}]
        kseg.chunks 'ab\ncd' ‚ñ∏ [{chunk:'ab' index:0 segl:['a' 'b']}, {chunk:'cd' index:3 segl:['c' 'd']}]
        
        kseg.chunks kseg('a')      ‚ñ∏ [chunk:'a'index:0 segl:['a']]
        kseg.chunks kseg(' a')     ‚ñ∏ [chunk:'a'index:1 segl:['a']]
        kseg.chunks kseg('ab cd')  ‚ñ∏ [{chunk:'ab' index:0 segl:['a' 'b']}, {chunk:'cd' index:3 segl:['c' 'd']}]
        kseg.chunks kseg('ab\ncd') ‚ñ∏ [{chunk:'ab' index:0 segl:['a' 'b']}, {chunk:'cd' index:3 segl:['c' 'd']}]

        kseg.chunks kseg.segls('a')      ‚ñ∏ [chunk:'a' index:0 segl:['a']]
        kseg.chunks kseg.segls(' a')     ‚ñ∏ [chunk:'a' index:1 segl:['a']]
        kseg.chunks kseg.segls('ab cd')  ‚ñ∏ [{chunk:'ab' index:0 segl:['a' 'b']}, {chunk:'cd' index:3 segl:['c' 'd']}]
        kseg.chunks kseg.segls('ab\ncd') ‚ñ∏ [{chunk:'ab' index:0 segl:['a' 'b']}, {chunk:'cd' index:3 segl:['c' 'd']}]
        
    # 000   000   0000000   00000000   0000000     0000000  
    # 000 0 000  000   000  000   000  000   000  000       
    # 000000000  000   000  0000000    000   000  0000000   
    # 000   000  000   000  000   000  000   000       000  
    # 00     00   0000000   000   000  0000000    0000000   
    
    ‚ñ∏ words
    
        kseg.words 'a' ‚ñ∏ [word:'a' index:0 segl:['a']]
        kseg.words 'ab cd'  ‚ñ∏ [{word:'ab' index:0 segl:['a' 'b']}, {word:'cd' index:3 segl:['c' 'd']}]
        kseg.words '@b.cd'  ‚ñ∏ [{word:'b' index:1 segl:['b']}, {word:'cd' index:3 segl:['c' 'd']}]
        
    #  0000000  000000000   0000000   00000000   000000000   0000000  000   000  000  000000000  000   000  
    # 000          000     000   000  000   000     000     000       000 0 000  000     000     000   000  
    # 0000000      000     000000000  0000000       000     0000000   000000000  000     000     000000000  
    #      000     000     000   000  000   000     000          000  000   000  000     000     000   000  
    # 0000000      000     000   000  000   000     000     0000000   00     00  000     000     000   000  
    
    ‚ñ∏ startsWith

        kseg.startsWith kseg('something') ''                ‚ñ∏ false
        kseg.startsWith kseg('something') ' '               ‚ñ∏ false
        kseg.startsWith kseg('something') 'Some'            ‚ñ∏ false
        kseg.startsWith kseg('something') 'son'             ‚ñ∏ false
        kseg.startsWith kseg('something') 'somethinga'      ‚ñ∏ false
        kseg.startsWith kseg('something') 'some'            ‚ñ∏ true
        kseg.startsWith kseg('something') 'something'       ‚ñ∏ true
        kseg.startsWith kseg('something') kseg('something') ‚ñ∏ true

    ‚ñ∏ endsWith
    
        kseg.endsWith kseg('something') ''                ‚ñ∏ false
        kseg.endsWith kseg('something') ' '               ‚ñ∏ false
        kseg.endsWith kseg('something') 'asomething'      ‚ñ∏ false
        kseg.endsWith kseg('something') 'Thing'           ‚ñ∏ false
        kseg.endsWith kseg('something') 'thing'           ‚ñ∏ true
        kseg.endsWith kseg('something') 'something'       ‚ñ∏ true
        kseg.endsWith kseg('something') kseg('something') ‚ñ∏ true
        
    #  0000000  00000000   000      000  000000000  
    # 000       000   000  000      000     000     
    # 0000000   00000000   000      000     000     
    #      000  000        000      000     000     
    # 0000000   000        0000000  000     000     
    
    ‚ñ∏ splitAtIndent
    
        kseg.splitAtIndent kseg('something') ‚ñ∏ [kseg('') kseg('something')]
        kseg.splitAtIndent kseg('  some')    ‚ñ∏ [kseg('  ') kseg('some')]
        kseg.splitAtIndent kseg('    more')  ‚ñ∏ [kseg('    ') kseg('more')]
        
    # 00000000   00000000  00000000   00000000   0000000   000000000  
    # 000   000  000       000   000  000       000   000     000     
    # 0000000    0000000   00000000   0000000   000000000     000     
    # 000   000  000       000        000       000   000     000     
    # 000   000  00000000  000        00000000  000   000     000     
    
    ‚ñ∏ repeat
    
        kseg.repeat 4      ‚ñ∏ kseg "    "
        kseg.repeat 4 '*'  ‚ñ∏ kseg "****"
        kseg.repeat 2 '‚óÇ‚ñ∏' ‚ñ∏ kseg "‚óÇ‚ñ∏‚óÇ‚ñ∏"
        
    # 000   000  000  0000000    000000000  000   000  
    # 000 0 000  000  000   000     000     000   000  
    # 000000000  000  000   000     000     000000000  
    # 000   000  000  000   000     000     000   000  
    # 00     00  000  0000000       000     000   000  
    
    ‚ñ∏ width 
    
        kseg.width null          ‚ñ∏ 0
        kseg.width undefined     ‚ñ∏ 0
        kseg.width ''            ‚ñ∏ 0
        kseg.width []            ‚ñ∏ 0
        kseg.width {}            ‚ñ∏ 0
        kseg.width '‚îè‚îÅ'          ‚ñ∏ 2
    
        kseg.width ' '           ‚ñ∏ 1
        kseg.width 'a'           ‚ñ∏ 1
        kseg.width 'üíÄ'          ‚ñ∏ 2
        kseg.width 'üî•'          ‚ñ∏ 2
        kseg.width 'üí©'          ‚ñ∏ 2
        kseg.width 'üî®'          ‚ñ∏ 2
        kseg.width 'üîß'          ‚ñ∏ 2
        kseg.width 'üî®üîß'        ‚ñ∏ 4
        kseg.width 'Â≠ó'          ‚ñ∏ 2
        kseg.width 'ÁöÑ'          ‚ñ∏ 2
        kseg.width 'Âùó'          ‚ñ∏ 2
        kseg.width 'Ê®°'          ‚ñ∏ 2
        kseg.width 'Â≠óÁöÑÊ®°Âùó'    ‚ñ∏ 8
        kseg.width 'üåæ'          ‚ñ∏ 2
        kseg.width 'üëÅ'           ‚ñ∏ 1
        kseg.width 'üñå'           ‚ñ∏ 1
        kseg.width 'üñç'           ‚ñ∏ 1
        kseg.width 'üõ†'           ‚ñ∏ 1
        kseg.width 'üßë‚Äçüåæ'          ‚ñ∏ 2
        kseg.width 'üßë'          ‚ñ∏ 2
        
        kseg.width kseg("hello world") ‚ñ∏ 11
        
    # 000000000  00000000   000  00     00  
    #    000     000   000  000  000   000  
    #    000     0000000    000  000000000  
    #    000     000   000  000  000 0 000  
    #    000     000   000  000  000   000  
    
    ‚ñ∏ trim
    
        kseg.trim ' '               ‚ñ∏ kseg ''
        kseg.trim ' x '             ‚ñ∏ kseg 'x'
        kseg.trim 'üñç'               ‚ñ∏ kseg 'üñç'  
        kseg.trim 'Â≠óÁöÑÊ®°Âùó'        ‚ñ∏ kseg 'Â≠óÁöÑÊ®°Âùó'
        kseg.trim 'üßë‚Äçüåæ'              ‚ñ∏ kseg 'üßë‚Äçüåæ'
        kseg.trim '  üñç    '         ‚ñ∏ kseg 'üñç'  
        kseg.trim '  Â≠óÁöÑÊ®°Âùó    '  ‚ñ∏ kseg 'Â≠óÁöÑÊ®°Âùó'
        kseg.trim '  üßë‚Äçüåæ   '         ‚ñ∏ kseg 'üßë‚Äçüåæ'
        
    # 000   000  00000000   0000000   0000000    
    # 000   000  000       000   000  000   000  
    # 000000000  0000000   000000000  000   000  
    # 000   000  000       000   000  000   000  
    # 000   000  00000000  000   000  0000000    
    
    ‚ñ∏ headCount
    
        kseg.headCount ' x ' ' '            ‚ñ∏ 1
        kseg.headCount '***xx***' '*'       ‚ñ∏ 3
        kseg.headCount kseg('***xx***') '*' ‚ñ∏ 3

        kseg.headCountWord ' x '    ‚ñ∏ 0
        kseg.headCountWord 'xxx  '  ‚ñ∏ 3
        kseg.headCountWord 'üßë‚Äçüåæ'     ‚ñ∏ 0
        kseg.headCountWord 'xxüßë‚Äçüåæ'   ‚ñ∏ 2
        
    # 000000000   0000000   000  000      
    #    000     000   000  000  000      
    #    000     000000000  000  000      
    #    000     000   000  000  000      
    #    000     000   000  000  0000000  
    
    ‚ñ∏ tailCount

        kseg.tailCount ' x ' ' '            ‚ñ∏ 1
        kseg.tailCount '***xx***' '*'       ‚ñ∏ 3
        kseg.tailCount kseg('***xx***') '*' ‚ñ∏ 3
        
        kseg.tailCountWord ' x '    ‚ñ∏ 0
        kseg.tailCountWord ' xxx'   ‚ñ∏ 3
        kseg.tailCountWord 'üßë‚Äçüåæ'     ‚ñ∏ 0
        kseg.tailCountWord 'üßë‚Äçüåæxx'   ‚ñ∏ 2
        
    # 000  000   000  0000000    00000000  000   000  000000000  
    # 000  0000  000  000   000  000       0000  000     000     
    # 000  000 0 000  000   000  0000000   000 0 000     000     
    # 000  000  0000  000   000  000       000  0000     000     
    # 000  000   000  0000000    00000000  000   000     000     
    
    ‚ñ∏ numIndent
    
        kseg.numIndent 'a'          ‚ñ∏ 0
        kseg.numIndent kseg('a')    ‚ñ∏ 0
        kseg.numIndent '   b'       ‚ñ∏ 3
        kseg.numIndent kseg('   ')  ‚ñ∏ 3
                
    # 000  000   000  0000000    00000000  000   000  
    # 000  0000  000  000   000  000        000 000   
    # 000  000 0 000  000   000  0000000     00000    
    # 000  000  0000  000   000  000        000 000   
    # 000  000   000  0000000    00000000  000   000  
    
    ‚ñ∏ indexAtWidth
    
        kseg.indexAtWidth kseg('')    0 ‚ñ∏ 0
        kseg.indexAtWidth kseg('')    1 ‚ñ∏ 0
        kseg.indexAtWidth kseg('a')   0 ‚ñ∏ 0
        kseg.indexAtWidth kseg('a')   1 ‚ñ∏ 1
        kseg.indexAtWidth kseg('a')   2 ‚ñ∏ 1
        kseg.indexAtWidth kseg('abc') 2 ‚ñ∏ 2
        kseg.indexAtWidth kseg('ab3') 3 ‚ñ∏ 3
        kseg.indexAtWidth kseg('ab3') 4 ‚ñ∏ 3
        
        kseg.indexAtWidth kseg('üßëüßë') 0 ‚ñ∏ 0
        kseg.indexAtWidth kseg('üßëüßë') 1 ‚ñ∏ 1
        kseg.indexAtWidth kseg('üßëüßë') 2 ‚ñ∏ 1
        kseg.indexAtWidth kseg('üßëüßë') 3 ‚ñ∏ 2
        kseg.indexAtWidth kseg('üßëüßë') 4 ‚ñ∏ 2
        kseg.indexAtWidth kseg('üßëüßë') 5 ‚ñ∏ 2
        kseg.indexAtWidth kseg('üßëüßë') 6 ‚ñ∏ 2
        
        kseg.indexAtWidth kseg('üßë‚Äçüåæüßë‚Äçüåæ') 0 ‚ñ∏ 0
        kseg.indexAtWidth kseg('üßë‚Äçüåæüßë‚Äçüåæ') 1 ‚ñ∏ 1
        kseg.indexAtWidth kseg('üßë‚Äçüåæüßë‚Äçüåæ') 2 ‚ñ∏ 1
        kseg.indexAtWidth kseg('üßë‚Äçüåæüßë‚Äçüåæ') 3 ‚ñ∏ 2
    
    #  0000000  00000000   0000000   000  
    # 000       000       000        000  
    # 0000000   0000000   000  0000  000  
    #      000  000       000   000  000  
    # 0000000   00000000   0000000   000  
    
    ‚ñ∏ segiAtWidth
    
        kseg.segiAtWidth kseg('')    0 ‚ñ∏ 0
        kseg.segiAtWidth kseg('')    1 ‚ñ∏ 0
        kseg.segiAtWidth kseg('a')   0 ‚ñ∏ 0
        kseg.segiAtWidth kseg('a')   1 ‚ñ∏ 1
        kseg.segiAtWidth kseg('a')   2 ‚ñ∏ 1
        kseg.segiAtWidth kseg('abc') 2 ‚ñ∏ 2
        kseg.segiAtWidth kseg('ab3') 3 ‚ñ∏ 3
        kseg.segiAtWidth kseg('ab3') 4 ‚ñ∏ 3
        
        kseg.segiAtWidth kseg('üßëüßë') 0 ‚ñ∏ 0
        kseg.segiAtWidth kseg('üßëüßë') 1 ‚ñ∏ 0
        kseg.segiAtWidth kseg('üßëüßë') 2 ‚ñ∏ 1
        kseg.segiAtWidth kseg('üßëüßë') 3 ‚ñ∏ 1
        kseg.segiAtWidth kseg('üßëüßë') 4 ‚ñ∏ 2
        kseg.segiAtWidth kseg('üßëüßë') 5 ‚ñ∏ 2
        kseg.segiAtWidth kseg('üßëüßë') 6 ‚ñ∏ 2   
        
    #  0000000  000       0000000    0000000  00000000   0000000  000000000  000   000   0000000   00000000   0000000    
    # 000       000      000   000  000       000       000          000     000 0 000  000   000  000   000  000   000  
    # 000       000      000   000  0000000   0000000   0000000      000     000000000  000   000  0000000    000   000  
    # 000       000      000   000       000  000            000     000     000   000  000   000  000   000  000   000  
    #  0000000  0000000   0000000   0000000   00000000  0000000      000     00     00   0000000   000   000  0000000    
    
    ‚ñ∏ spanForClosestWordAtColumn
    
        kseg.spanForClosestWordAtColumn kseg('abc def') 0 ‚ñ∏ [0 3]        
        kseg.spanForClosestWordAtColumn kseg('abc def') 1 ‚ñ∏ [0 3]        
        kseg.spanForClosestWordAtColumn kseg('abc def') 2 ‚ñ∏ [0 3]        
        kseg.spanForClosestWordAtColumn kseg('abc def') 3 ‚ñ∏ [0 3]        
        kseg.spanForClosestWordAtColumn kseg('abc def') 4 ‚ñ∏ [4 7]        
        kseg.spanForClosestWordAtColumn kseg('ab  def') 3 ‚ñ∏ [0 2]        
        kseg.spanForClosestWordAtColumn kseg('ab  def') 4 ‚ñ∏ [4 7]        
        
        kseg.spanForClosestWordAtColumn kseg('     ') 0 ‚ñ∏ [0 0]        
        kseg.spanForClosestWordAtColumn kseg('     ') 2 ‚ñ∏ [2 2]        
        kseg.spanForClosestWordAtColumn kseg('     ') 3 ‚ñ∏ [3 3]
        
        kseg.spanForClosestWordAtColumn kseg('   xy') 2 ‚ñ∏ [3 5]        
        kseg.spanForClosestWordAtColumn kseg('xy   ') 3 ‚ñ∏ [0 2]        
        
    #  0000000   0000000   000      000      00000000   0000000  000000000  
    # 000       000   000  000      000      000       000          000     
    # 000       000   000  000      000      0000000   000          000     
    # 000       000   000  000      000      000       000          000     
    #  0000000   0000000   0000000  0000000  00000000   0000000     000     
    
    ‚ñ∏ collectGraphemes
    
        kseg.collectGraphemes kseg('hello world') ‚ñ∏ ['h' 'e' 'l' 'o' ' ' 'w' 'r' 'd']
        
        text = kseg """
             0000000  000       0000000    0000000  00000000   0000000  000000000  000   000   0000000   00000000   0000000    
            000       000      000   000  000       000       000          000     000 0 000  000   000  000   000  000   000  
            000       000      000   000  0000000   0000000   0000000      000     000000000  000   000  0000000    000   000  
            000       000      000   000       000  000            000     000     000   000  000   000  000   000  000   000  
             0000000  0000000   0000000   0000000   00000000  0000000      000     00     00   0000000   000   000  0000000    
            """
        
        kseg.collectGraphemes text ‚ñ∏ [' ' '0' '\n']
        